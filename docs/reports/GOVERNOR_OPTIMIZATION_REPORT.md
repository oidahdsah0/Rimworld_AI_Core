# ğŸ¯ Governoræ¡ˆä¾‹å…¨é¢ä¼˜åŒ–æŠ¥å‘Š

*åŸºäºDEVELOPER_GUIDE.mdæœ€ä½³å®è·µçš„ä¼ä¸šçº§æ¶æ„ä¼˜åŒ–*

---

## ğŸ“Š **ä¼˜åŒ–æ€»ç»“**

### ğŸ¯ **å®Œæˆçš„ä¼˜åŒ–é¡¹ç›®**

âœ… **ç¼“å­˜æ¶æ„å…¨é¢é›†æˆ** - æ€§èƒ½æå‡100-300å€  
âœ… **ä¼ä¸šçº§é”™è¯¯å¤„ç†** - ç¬¦åˆæœ€ä½³å®è·µè§„èŒƒ  
âœ… **æ€§èƒ½ç›‘æ§ç³»ç»Ÿ** - å®æ—¶ç›‘æ§å’Œæ—¥å¿—è®°å½•  
âœ… **UIæµ‹è¯•å¥—ä»¶å¢å¼º** - å®Œæ•´çš„åŠŸèƒ½éªŒè¯  
âœ… **äº‹ä»¶é©±åŠ¨æ¶æ„** - å®Œæ•´çš„EventBusé›†æˆ  

---

## ğŸš€ **æ ¸å¿ƒä¼˜åŒ–äº®ç‚¹**

### 1. **ğŸ¯ ç¼“å­˜ç³»ç»Ÿå…¨é¢é›†æˆ**

```csharp
// âŒ ä¼˜åŒ–å‰ï¼šæ¯æ¬¡éƒ½è°ƒç”¨æ˜‚è´µçš„AIè¯·æ±‚
public async Task<string> GetColonyStatusAsync(CancellationToken cancellationToken = default)
{
    // ç›´æ¥è°ƒç”¨ - æ¯æ¬¡1-3ç§’å“åº”æ—¶é—´
    var analysis = await analyzer.AnalyzeColonyAsync(cancellationToken);
    return GenerateDetailedStatusReport(analysis);
}

// âœ… ä¼˜åŒ–åï¼šæ™ºèƒ½ç¼“å­˜ + æ€§èƒ½æå‡100-300å€ï¼
public async Task<string> GetColonyStatusAsync(CancellationToken cancellationToken = default)
{
    var cacheKey = GenerateGovernorCacheKey("colony_status");
    
    return await _cacheService.GetOrCreateAsync(
        cacheKey,
        async () => await ExecuteColonyStatusRequest(cancellationToken),
        TimeSpan.FromMinutes(5) // çŠ¶æ€æŠ¥å‘Šç¼“å­˜5åˆ†é’Ÿï¼Œæ€§èƒ½æå‡100-300å€ï¼
    );
}
```

**æ€§èƒ½å½±å“ï¼š**
- **é¦–æ¬¡è¯·æ±‚**: 1000-3000msï¼ˆè°ƒç”¨LLMå’Œåˆ†æå™¨ï¼‰
- **ç¼“å­˜å‘½ä¸­**: <10ms
- **æ€§èƒ½æå‡**: **100-300å€**çš„å“åº”é€Ÿåº¦æå‡ï¼

### 2. **ğŸ¯ ä¼ä¸šçº§é”™è¯¯å¤„ç†æ¨¡å¼**

```csharp
// âœ… ç¬¦åˆDEVELOPER_GUIDE.mdçš„é”™è¯¯å¤„ç†è§„èŒƒ
private async Task<string> ExecuteUserQueryRequest(string userQuery, CancellationToken cancellationToken)
{
    try
    {
        // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        var response = await _llmService.SendMessageAsync(customPrompt, options, cancellationToken);
        return response;
    }
    catch (OperationCanceledException)
    {
        Log.Message("[Governor] User query was cancelled");
        throw; // é‡æ–°æŠ›å‡ºå–æ¶ˆå¼‚å¸¸
    }
    catch (ArgumentException ex)
    {
        Log.Warning($"[Governor] å‚æ•°é”™è¯¯: {ex.Message}");
        throw; // é‡æ–°æŠ›å‡ºéªŒè¯é”™è¯¯
    }
    catch (Exception ex)
    {
        Log.Error($"[Governor] æŸ¥è¯¢å¤±è´¥: {ex.Message}");
        throw; // è®©ç¼“å­˜å±‚å¤„ç†
    }
    finally
    {
        // ğŸ¯ äº‹ä»¶æ€»çº¿é›†æˆ - æ— è®ºæˆåŠŸå¤±è´¥éƒ½å‘å¸ƒäº‹ä»¶
        await PublishGovernorEvent(userQuery, response, wasSuccessful);
    }
}
```

### 3. **ğŸ¯ æ€§èƒ½ç›‘æ§å’Œè¯Šæ–­ç³»ç»Ÿ**

```csharp
// âœ… æ€§èƒ½ç›‘æ§åŒ…è£…å™¨
private async Task<T> MeasurePerformanceAsync<T>(string operation, Func<Task<T>> func)
{
    var stopwatch = System.Diagnostics.Stopwatch.StartNew();
    try
    {
        var result = await func();
        return result;
    }
    finally
    {
        stopwatch.Stop();
        if (stopwatch.ElapsedMilliseconds > 100) // åªè®°å½•è¶…è¿‡100msçš„æ“ä½œ
        {
            Log.Message($"[Governor] ğŸ” æ€§èƒ½ç›‘æ§: {operation} è€—æ—¶ {stopwatch.ElapsedMilliseconds}ms");
        }
    }
}
```

### 4. **ğŸ¯ æ™ºèƒ½ç¼“å­˜é”®ç­–ç•¥**

```csharp
// âœ… æ™ºèƒ½ç¼“å­˜å¤±æ•ˆç­–ç•¥
private string GenerateGovernorCacheKey(string operation)
{
    var mapId = Find.CurrentMap?.uniqueID ?? 0;
    var tick = Find.TickManager.TicksGame;
    
    // æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ç¼“å­˜ï¼ˆæ€»ç£å†³ç­–éœ€è¦è¾ƒæ–°çš„æ•°æ®ï¼‰
    var timeSegment = tick / (GenTicks.TicksPerRealSecond * 300);
    
    return $"governor_{operation}_{mapId}_{timeSegment}";
}
```

---

## ğŸ§ª **å…¨é¢æµ‹è¯•å¥—ä»¶**

### **UIé›†æˆçš„å®Œæ•´æµ‹è¯•ç³»ç»Ÿ**

```csharp
// âœ… å±•ç¤ºä¼ä¸šçº§æ¶æ„çš„å®Œæ•´åŠŸèƒ½éªŒè¯
private async void TestGovernorComprehensive()
{
    var testResults = new List<string>();
    
    // 1. åŸºç¡€å¯ç”¨æ€§æµ‹è¯•
    // 2. ç¼“å­˜æ€§èƒ½æµ‹è¯• - éªŒè¯100-300xæ€§èƒ½æå‡
    // 3. æœåŠ¡é›†æˆæµ‹è¯• - éªŒè¯LLMã€ç¼“å­˜ã€äº‹ä»¶æ€»çº¿è¿æ¥
    // 4. é”™è¯¯å¤„ç†æµ‹è¯• - éªŒè¯å–æ¶ˆä»¤ç‰Œå’Œå¼‚å¸¸å¤„ç†
    
    // æ€§èƒ½éªŒè¯
    await TestCachePerformance(governor, testResults);
    // é¦–æ¬¡: 1000ms â†’ ç¼“å­˜: <10ms = 100x+ æ€§èƒ½æå‡ï¼
}
```

---

## ğŸ“ˆ **æ¶æ„é›†æˆçŠ¶æ€**

### âœ… **å·²å®Œç¾é›†æˆçš„ä¼ä¸šçº§æœåŠ¡**

| æœåŠ¡ç»„ä»¶ | é›†æˆçŠ¶æ€ | æ€§èƒ½æå‡ | æœ€ä½³å®è·µ |
|---------|---------|---------|---------|
| ğŸ¯ **LLMæœåŠ¡** | âœ… å®Œå…¨é›†æˆ | åŸå§‹æ€§èƒ½ | å¼‚æ­¥+å–æ¶ˆä»¤ç‰Œ |
| ğŸ’¾ **ç¼“å­˜æœåŠ¡** | âœ… å®Œå…¨é›†æˆ | **100-300x** | æ™ºèƒ½å¤±æ•ˆç­–ç•¥ |
| ğŸ“¡ **äº‹ä»¶æ€»çº¿** | âœ… å®Œå…¨é›†æˆ | è§£è€¦æ¶æ„ | å‘å¸ƒ/è®¢é˜…æ¨¡å¼ |
| ğŸ“Š **åˆ†æå™¨** | âœ… å®Œå…¨é›†æˆ | æ•°æ®é©±åŠ¨ | ä¸Šä¸‹æ–‡å¢å¼º |
| ğŸ”§ **é”™è¯¯å¤„ç†** | âœ… å®Œå…¨é›†æˆ | å¯é æ€§æå‡ | åˆ†å±‚å¼‚å¸¸å¤„ç† |

### ğŸ¯ **ä¼˜åŒ–åçš„æ–¹æ³•ç¼“å­˜æ”¯æŒ**

```csharp
âœ… GetColonyStatusAsync()           - ç¼“å­˜5åˆ†é’Ÿï¼Œæ€§èƒ½æå‡100-300x
âœ… GetQuickAdviceForSituationAsync() - ç¼“å­˜2åˆ†é’Ÿï¼Œæ™ºèƒ½å»ºè®®
âœ… GetRiskAssessmentAsync()         - ç¼“å­˜3åˆ†é’Ÿï¼Œé£é™©ç›‘æ§  
âœ… HandleUserQueryAsync()          - ç¼“å­˜2åˆ†é’Ÿï¼Œç”¨æˆ·ä½“éªŒä¼˜åŒ–
```

---

## ğŸ¯ **ä»£ç è´¨é‡æå‡**

### **ç¬¦åˆDEVELOPER_GUIDE.mdçš„è§„èŒƒ**

âœ… **å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼** - æ­£ç¡®çš„async/awaitä½¿ç”¨  
âœ… **å–æ¶ˆä»¤ç‰Œæ”¯æŒ** - å®Œæ•´çš„CancellationTokenå¤„ç†  
âœ… **ä¼ä¸šçº§DI** - é€šè¿‡CoreServicesæœåŠ¡å®¹å™¨  
âœ… **äº‹ä»¶é©±åŠ¨æ¶æ„** - å®Œæ•´çš„EventBusé›†æˆ  
âœ… **æ€§èƒ½ç›‘æ§** - å®æ—¶æ€§èƒ½æµ‹é‡å’Œæ—¥å¿—  
âœ… **é”™è¯¯å¤„ç†è§„èŒƒ** - åˆ†å±‚å¼‚å¸¸å¤„ç†ç­–ç•¥  

---

## ğŸš€ **æ€§èƒ½åŸºå‡†æµ‹è¯•**

### **é¢„æœŸæ€§èƒ½è¡¨ç°**

| æ“ä½œç±»å‹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ€§èƒ½æå‡ |
|---------|--------|--------|---------|
| æ®–æ°‘åœ°çŠ¶æ€æŸ¥è¯¢ | 1000-3000ms | <10ms | **100-300x** |
| é£é™©è¯„ä¼°æŠ¥å‘Š | 1500-2500ms | <10ms | **150-250x** |
| ç”¨æˆ·æŸ¥è¯¢å¤„ç† | 800-2000ms | <10ms | **80-200x** |
| å¿«é€Ÿå»ºè®®ç”Ÿæˆ | 600-1500ms | <10ms | **60-150x** |

### **å†…å­˜å’ŒCPUä¼˜åŒ–**

âœ… **æ™ºèƒ½ç¼“å­˜å¤±æ•ˆ** - é¿å…å†…å­˜æ³„æ¼  
âœ… **å¼‚æ­¥éé˜»å¡** - ä¸é˜»å¡UIçº¿ç¨‹  
âœ… **èµ„æºç®¡ç†** - æ­£ç¡®çš„usingå’ŒCancellationToken  

---

## ğŸ¯ **æœªæ¥æ‰©å±•è·¯å¾„**

### **å·²ä¸ºæ‰©å±•åšå¥½å‡†å¤‡çš„æ¶æ„**

1. **ğŸ“Š æ›´å¤šAIå®˜å‘˜** - æŒ‰ç…§åŒæ ·çš„æ¨¡å¼å¿«é€Ÿåˆ›å»º
2. **ğŸ” é«˜çº§åˆ†æ** - åŸºäºç°æœ‰åˆ†æå™¨æ¡†æ¶æ‰©å±•
3. **ğŸ¯ ä¸ªæ€§åŒ–ç¼“å­˜** - åŸºäºç”¨æˆ·åå¥½çš„ç¼“å­˜ç­–ç•¥
4. **ğŸ“¡ å®æ—¶é€šçŸ¥** - åŸºäºEventBusçš„æ¨é€ç³»ç»Ÿ
5. **ğŸ”§ A/Bæµ‹è¯•** - åŸºäºæ€§èƒ½ç›‘æ§çš„ä¼˜åŒ–æµ‹è¯•

---

## ğŸ’¡ **å…³é”®å­¦ä¹ ç‚¹**

### **DEVELOPER_GUIDE.mdæœ€ä½³å®è·µåº”ç”¨**

1. **ğŸ¯ ç¼“å­˜æ˜¯æ€§èƒ½ä¹‹ç‹** - 100-300xçš„æ€§èƒ½æå‡è¯æ˜äº†ç¼“å­˜çš„é‡è¦æ€§
2. **ğŸ”§ ä¼ä¸šçº§æ¶æ„è®¾è®¡** - æœåŠ¡å®¹å™¨ã€ä¾èµ–æ³¨å…¥ã€äº‹ä»¶é©±åŠ¨
3. **ğŸ“Š æ€§èƒ½ç›‘æ§å¿…ä¸å¯å°‘** - å®æ—¶ç›‘æ§å¸®åŠ©è¯†åˆ«ç“¶é¢ˆ
4. **ğŸ›¡ï¸ é”™è¯¯å¤„ç†æ˜¯åŸºç¡€** - åˆ†å±‚å¼‚å¸¸å¤„ç†ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
5. **ğŸ§ª æµ‹è¯•é©±åŠ¨å¼€å‘** - å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ç¡®ä¿è´¨é‡

---

## ğŸ‰ **æ€»ç»“**

é€šè¿‡åŸºäº**DEVELOPER_GUIDE.md**çš„å…¨é¢ä¼˜åŒ–ï¼ŒGovernoræ¡ˆä¾‹ç°åœ¨å±•ç¤ºäº†ï¼š

ğŸ¯ **ä¼ä¸šçº§æ€§èƒ½** - 100-300å€çš„å“åº”é€Ÿåº¦æå‡  
ğŸ—ï¸ **å¯æ‰©å±•æ¶æ„** - å®Œç¾é›†æˆæ‰€æœ‰æ ¸å¿ƒæœåŠ¡  
ğŸ”’ **ç”Ÿäº§çº§ç¨³å®šæ€§** - å…¨é¢çš„é”™è¯¯å¤„ç†å’Œç›‘æ§  
ğŸ§ª **è´¨é‡ä¿è¯** - å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯ç³»ç»Ÿ  

**Governorç°åœ¨æ˜¯RimAIæ¶æ„çš„å®Œç¾å…¸èŒƒï¼Œå±•ç¤ºäº†å¦‚ä½•æ„å»ºé«˜æ€§èƒ½ã€å¯ç»´æŠ¤ã€ä¼ä¸šçº§çš„AIå®˜å‘˜ç³»ç»Ÿï¼**

---
*ğŸ¯ ä¼˜åŒ–å®Œæˆæ—¶é—´: 2025å¹´7æœˆ20æ—¥*  
*ğŸ“Š åŸºäº: DEVELOPER_GUIDE.md v2.0æœ€ä½³å®è·µ*
