# RimAI Core æµå¼APIæ”¹é€ å®ŒæˆæŠ¥å‘Š

## æ”¹é€ æ¦‚è¿°

åŸºäº RimAI Framework çš„æµå¼APIåŠŸèƒ½ï¼Œæˆ‘ä»¬å®Œæˆäº†å¯¹ RimAI Core å®¢æˆ·ç«¯Modçš„å…¨é¢æ”¹é€ ï¼Œå……åˆ†åˆ©ç”¨äº†æ–°çš„æµå¼ä¼ è¾“èƒ½åŠ›ï¼Œå¹¶å±•ç¤ºäº†æœ€ä½³å®è·µã€‚

## Framework API ä¼˜åŒ– âœ…

### æ–°å¢çš„å…³é”®APIæ–¹æ³•ï¼š

1. **`RimAIApi.IsStreamingEnabled()`**
   - æ£€æŸ¥å½“å‰æ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“
   - ä¸‹æ¸¸Modå¯æ®æ­¤è°ƒæ•´UIè¡Œä¸ºå’Œç”¨æˆ·æœŸæœ›

2. **`RimAIApi.GetCurrentSettings()`**
   - è·å–å½“å‰Frameworkè®¾ç½®ä¿¡æ¯
   - æä¾›æ¨¡å‹åç§°ã€ç«¯ç‚¹ç­‰é…ç½®ä¿¡æ¯

3. **`RimAIApi.GetChatCompletionStream()` å¢å¼ºç‰ˆ**
   - æ·»åŠ äº†CancellationTokenæ”¯æŒ
   - æä¾›å‘åå…¼å®¹çš„é‡è½½æ–¹æ³•

4. **`RimAIApi.GetChatCompletionWithOptions()`**
   - æ”¯æŒå¼ºåˆ¶å¯ç”¨/ç¦ç”¨æµå¼ä¼ è¾“
   - ç»™ä¸‹æ¸¸Modç»†ç²’åº¦æ§åˆ¶èƒ½åŠ›

### è§£å†³çš„é—®é¢˜ï¼š

- âœ… ä¿®å¤äº† `RimAISettings` å‘½åç©ºé—´å¯¼å…¥é—®é¢˜
- âœ… é¿å…äº†æ–¹æ³•é‡è½½å†²çª
- âœ… å¢å¼ºäº†APIçš„å°è£…æ€§ï¼Œé¿å…ç›´æ¥è®¿é—® `LLMManager.Instance`

## Core å®¢æˆ·ç«¯æ”¹é€  âœ…

### 1. ä¸»ç•Œé¢æ›´æ–° (`MainTabWindow_RimAI.cs`)

**æ–°å¢åŠŸèƒ½ï¼š**
- ğŸš€ å®æ—¶æ˜¾ç¤ºå½“å‰å“åº”æ¨¡å¼ï¼ˆå¿«é€Ÿ/æ ‡å‡†ï¼‰
- âš¡ æµå¼å“åº”çš„å®æ—¶æ›´æ–°å’Œå…‰æ ‡æ•ˆæœ
- ğŸ¯ æ ¹æ®Frameworkè®¾ç½®æ™ºèƒ½é€‰æ‹©APIç­–ç•¥
- ğŸ“± æ”¹è¿›çš„UIåé¦ˆå’ŒçŠ¶æ€æ˜¾ç¤º

**æ ¸å¿ƒç‰¹æ€§ï¼š**
```csharp
// æ™ºèƒ½æ¨¡å¼æ£€æµ‹
bool useStreaming = RimAIApi.IsStreamingEnabled();

// æµå¼å®æ—¶æ›´æ–°
await RimAIApi.GetChatCompletionStream(prompt, chunk => {
    streamingResponse.Append(chunk);
    lastUpdateTime = Time.unscaledTime;
});
```

### 2. æ™ºèƒ½æ€»ç£ç»„ä»¶ (`SmartGovernor.cs`)

**è®¾è®¡äº®ç‚¹ï¼š**
- ğŸ›ï¸ **å¿«é€Ÿå†³ç­–**: ç´§æ€¥æƒ…å†µä¸‹çš„å³æ—¶å»ºè®®ï¼ˆå¼ºåˆ¶æµå¼ï¼‰
- ğŸ“Š **è¯¦ç»†ç­–ç•¥**: æ·±åº¦åˆ†æå’Œé•¿æœŸè§„åˆ’ï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰
- ğŸ¬ **äº‹ä»¶è§£è¯´**: å®æ—¶æµå¼è§£è¯´åŠŸèƒ½
- ğŸ”„ **æ™ºèƒ½é€‚é…**: æ ¹æ®ç”¨æˆ·è®¾ç½®è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// ç´§æ€¥æƒ…å†µ - å¼ºåˆ¶ä½¿ç”¨æµå¼
var quickAdvice = await SmartGovernor.Instance.GetQuickDecision(emergency);

// æ·±åº¦åˆ†æ - å°Šé‡ç”¨æˆ·è®¾ç½®
var strategy = await SmartGovernor.Instance.GetDetailedStrategy(colonyStatus);
```

### 3. é«˜çº§AIå¯¹è¯çª—å£ (`Dialog_AdvancedAIAssistant.cs`)

**å…ˆè¿›ç‰¹æ€§ï¼š**
- ğŸ’¬ **å¤šæ¨¡å¼å¯¹è¯**: æ™®é€š/å¿«é€Ÿå“åº”åŒæ¨¡å¼
- âŒ¨ï¸ **æ‰“å­—æœºæ•ˆæœ**: æµå¼å“åº”çš„è§†è§‰åŒ–å‘ˆç°
- ğŸ›ï¸ **é›†æˆæ€»ç£**: ä¸€é”®è·å–ç®¡ç†å»ºè®®
- ğŸ“ˆ **çŠ¶æ€æ„ŸçŸ¥**: æ˜¾ç¤ºAIæœåŠ¡çŠ¶æ€å’Œé…ç½®ä¿¡æ¯

**æ™ºèƒ½UIé€‚é…ï¼š**
```csharp
// æ ¹æ®æ¶ˆæ¯ç‰¹å¾å†³å®šæ˜¯å¦ä½¿ç”¨æµå¼
private bool ShouldUseStreaming(string message)
{
    return message.Length < 100 || 
           message.Contains("å¿«é€Ÿ") || 
           message.Contains("ç´§æ€¥");
}
```

## æœ€ä½³å®è·µå±•ç¤º

### 1. å“åº”æ¨¡å¼é€‚é…
```csharp
if (RimAIApi.IsStreamingEnabled())
{
    statusLabel.text = "ğŸš€ å¿«é€Ÿå“åº”æ¨¡å¼å·²å¯ç”¨";
    // è°ƒæ•´ç”¨æˆ·æœŸæœ›å’ŒUIè¡Œä¸º
}
else
{
    statusLabel.text = "ğŸ“ æ ‡å‡†å“åº”æ¨¡å¼";
    // æ˜¾ç¤ºå¯èƒ½éœ€è¦ç­‰å¾…çš„æç¤º
}
```

### 2. åœºæ™¯åŒ–APIé€‰æ‹©
- **å®æ—¶UIäº¤äº’**: ä½¿ç”¨æµå¼APIæä¾›å³æ—¶åé¦ˆ
- **åå°åˆ†æ**: ä½¿ç”¨æ ‡å‡†APIè¿›è¡Œæ·±åº¦å¤„ç†
- **ç´§æ€¥å“åº”**: å¼ºåˆ¶æµå¼ä»¥ç¡®ä¿å¿«é€Ÿååº”

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **è§†è§‰åé¦ˆ**: å…‰æ ‡é—ªçƒã€æ‰“å­—æœºæ•ˆæœ
- **çŠ¶æ€æç¤º**: æ¸…æ™°çš„æ¨¡å¼æŒ‡ç¤ºå’Œå¤„ç†çŠ¶æ€
- **æ™ºèƒ½é€‰æ‹©**: æ ¹æ®å†…å®¹ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥

## æŠ€æœ¯äº®ç‚¹

1. **å®Œå…¨å‘åå…¼å®¹**: ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯äº«å—æµå¼ä¼ è¾“æ”¶ç›Š
2. **æ™ºèƒ½é™çº§**: æµå¼ä¸å¯ç”¨æ—¶è‡ªåŠ¨å›é€€åˆ°æ ‡å‡†æ¨¡å¼
3. **ç”¨æˆ·æ§åˆ¶**: å°Šé‡ç”¨æˆ·çš„å…¨å±€è®¾ç½®åå¥½
4. **æ€§èƒ½ä¼˜åŒ–**: åˆç†çš„UIæ›´æ–°é¢‘ç‡å’Œå†…å­˜ç®¡ç†
5. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œç”¨æˆ·åé¦ˆ

## ä½¿ç”¨å»ºè®®

### å¯¹äºä¸‹æ¸¸Modå¼€å‘è€…ï¼š

1. **æ£€æŸ¥è®¾ç½®**: æ€»æ˜¯å…ˆè°ƒç”¨ `RimAIApi.IsStreamingEnabled()` äº†è§£å½“å‰æ¨¡å¼
2. **åœºæ™¯åŒ¹é…**: 
   - UIäº¤äº’ â†’ æµå¼API
   - åå°ä»»åŠ¡ â†’ æ ‡å‡†API
   - ç´§æ€¥å“åº” â†’ å¼ºåˆ¶æµå¼
3. **ç”¨æˆ·åé¦ˆ**: æ ¹æ®æ¨¡å¼æä¾›é€‚å½“çš„çŠ¶æ€æç¤º
4. **æ€§èƒ½è€ƒè™‘**: æ§åˆ¶UIæ›´æ–°é¢‘ç‡ï¼Œé¿å…è¿‡åº¦é‡ç»˜

### æ¨èçš„é›†æˆæ¨¡å¼ï¼š
```csharp
public async Task ProcessAIRequest(string prompt)
{
    // 1. æ£€æŸ¥å½“å‰è®¾ç½®
    bool isStreaming = RimAIApi.IsStreamingEnabled();
    
    // 2. è°ƒæ•´UIæç¤º
    UpdateUIForCurrentMode(isStreaming);
    
    // 3. é€‰æ‹©åˆé€‚çš„API
    if (needRealTimeUpdates && isStreaming)
    {
        await RimAIApi.GetChatCompletionStream(prompt, OnChunkReceived);
    }
    else
    {
        var response = await RimAIApi.GetChatCompletion(prompt);
        OnResponseComplete(response);
    }
}
```

## æ€»ç»“

é€šè¿‡è¿™æ¬¡æ”¹é€ ï¼ŒRimAI Core ç°åœ¨èƒ½å¤Ÿï¼š

- âœ… å……åˆ†åˆ©ç”¨Frameworkçš„æµå¼ä¼ è¾“èƒ½åŠ›
- âœ… ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„å“åº”ä½“éªŒ
- âœ… æ™ºèƒ½é€‚é…ä¸åŒä½¿ç”¨åœºæ™¯
- âœ… ä¸ºå…¶ä»–Modå¼€å‘è€…æä¾›æœ€ä½³å®è·µå‚è€ƒ

è¿™ä¸ªæ”¹é€ å±•ç¤ºäº†å¦‚ä½•æ­£ç¡®åœ°é›†æˆå’Œä½¿ç”¨æµå¼APIï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ã€‚
